import"./index.css";import"./global.css";document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".button"),t=document.querySelector(".delete-chat-history"),s=document.querySelectorAll(".minimize-button"),n=document.querySelectorAll(".minimize-button1"),o=document.querySelector(".welcome-page"),a=document.querySelector(".chat-page"),i=document.querySelectorAll(".message-1, .message-2, .message-3, .message-4, .message-5, .message-6, .message-7"),r=document.querySelector(".inquiries-button"),c=document.querySelector(".send-button"),l=document.querySelector(".text-field"),d=(document.querySelector(".message-window"),"https://sure-urchin-33978.upstash.io"),m="AYS6ASQgZWFkYTZiYzctZmQxNC00N2M1LThkYzQtYjZiMjQwZmYwYzFmZTI0MGNjMTNhNThhNGZjY2IwODAyMzQzMmMyMmNkOTg=";let u=!1,y=!0,p=null,h={"message-1":!1,"message-2":!1,"message-3":!1,"message-4":!1,"message-5":!1,"message-6":!1,"message-7":!1};var f={"message-1":[],"message-2":[],"message-3":[],"message-4":[],"message-5":[],"message-6":[],"message-7":[]};const g={"message-1":"https://flowise.piqueai.com.au/api/v1/prediction/f7f62a8e-592e-4402-8645-10e55f4b902c","message-2":"https://flowise.piqueai.com.au/api/v1/prediction/f1538ba8-090b-4502-9830-89bf2469ab89","message-3":"https://flowise.piqueai.com.au/api/v1/prediction/0aee71d0-9d83-4037-b35a-c74475cbb23c","message-4":"https://flowise.piqueai.com.au/api/v1/prediction/92f81990-97b7-42cb-baa7-a77f3f295f7e","message-5":"https://flowise.piqueai.com.au/api/v1/prediction/957ed416-c3c6-479f-aee4-aadd6e38e96c","message-6":"","message-7":""};function w(){let e=localStorage.getItem("sessionId");return e||(e="TEST-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),localStorage.setItem("sessionId",e)),e}async function b(e,t,s,n){const o={question:t,overrideConfig:{sessionId:`${w()}-${s}`}};try{const t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),i=await t.json();if(p===s&&"flex"===a.style.display)z(i.text,"bot",s);else{const e=N();f[s].push({type:"bot",text:i.text,timestamp:e}),S()}n&&n()}catch(e){console.error("Error querying the bot:",e);const t="Sorry, there was an error communicating with the bot.";p===s&&"flex"===a.style.display?z(t,"bot",s):(f[s].push({type:"bot",text:t}),S()),n&&n()}}function E(e){f[e].length>0&&(f[e].forEach((t=>{z(t.text,t.type,e,t.timestamp)})),f[e]=[])}function S(){let e=0;for(const t in f){const s=f[t].length,n=document.querySelector(`.${t} .notification-icon`),o=n.querySelector(".unread-message-count");s>0?(n.style.display="flex",o.textContent=s,e+=s):n.style.display="none"}document.querySelector(".notification-icon-minimized").style.display=e>0?"flex":"none"}function v(){o.style.display="none",a.style.display="flex",y=!1}function q(){const e=this.className.split(" ")[0];if(h[e])p=e,$(p),E(p);else{const t=this.querySelector(".question").textContent;p=e,$(p),setTimeout((()=>{z(t,"user",p),b(g[e],t,e)}),1e3),h[e]=!0}u=!0,v(),S()}function $(e){document.querySelectorAll(".message-window").forEach((e=>{e.style.display="none"}));let t=document.getElementById(`bot-window-${e}`);t||(t=function(e){const t=document.querySelector(".message-interface"),s=document.createElement("div");s.id=`bot-window-${e}`,s.classList.add("message-window"),s.style.display="none";const n=t.querySelector(".message-interface-child");return t.insertBefore(s,n),s}(e),async function(e){const t=`${w()}-${e}`;try{const s=await fetch(`${d}/lrange/${t}/0/-1`,{method:"GET",headers:{Authorization:`Bearer ${m}`}}),n=await s.json();n&&Array.isArray(n.result)?n.result.map((e=>JSON.parse(e))).reverse().forEach((t=>{z(t.text,t.type,e,t.timestamp,!1)})):console.error("Invalid format of messages received:",n)}catch(e){console.error("Error loading chat history from Upstash:",e)}}(e)),t.style.display="block",p=e,S()}function T(){if(p){const e=document.getElementById(`bot-window-${p}`);e&&(e.innerHTML="")}}function x(){const e=l.value.trim();e&&(z(e,"user",p),l.value="",c.disabled=!0,l.disabled=!0,p&&g[p])&&b(g[p],e,p,(()=>{c.disabled=!1,l.disabled=!1,l.focus()}))}function N(){const e=new Date;let t=e.getHours(),s=e.getMinutes(),n=t>=12?"pm":"am";return t%=12,t=t||12,s=s<10?"0"+s:s,t+":"+s+" "+n}async function z(e,t,s,n=null,o=!0){const a=document.getElementById(`bot-window-${s}`);if(!a)return;const i=document.createElement("div"),r="user"===t?"user-message-window":"bot-message-window",c=a.querySelector("."+r+":last-child");let l;n||(n=N());const u=document.createElement("div");u.classList.add("am"),c&&c.classList.contains(t+"-message")?l=c:(l=document.createElement("div"),l.classList.add(r),u.textContent=n,l.appendChild(u),a.appendChild(l)),i.classList.add(t+"-message");const y=document.createElement("div");if(y.textContent=e,i.appendChild(y),l.appendChild(i),a.scrollTop=a.scrollHeight,o&&s){const o=`${w()}-${s}`,a=JSON.stringify({type:t,text:e,timestamp:n||N()});try{await fetch(`${d}/lpush/${o}`,{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:a})}catch(e){console.error("Error sending message to Upstash:",e)}}}t.addEventListener("click",(async function(){if(p){const e=`${w()}-${p}`;try{await fetch(`${d}/del/${e}`,{method:"POST",headers:{Authorization:`Bearer ${m}`}}),T()}catch(e){console.error("Error clearing chat history in Upstash:",e)}try{await fetch(`https://us1-top-bull-37476.upstash.io/del/${e}`,{method:"POST",headers:{Authorization:"Bearer AZJkACQgZjk0NTI2NTAtMjQ0Ni00NzUyLTk4NzMtNzRmMDk3ZjQzOTQ5ZTc4YTg0NDdmYmM1NDUzZTgzODQwNWI0MjhiM2U0OTQ="}}),T()}catch(e){console.error("Error clearing chat history in Upstash:",e)}}})),e.addEventListener("click",(function(){!1===y?(o.style.display="none",a.style.display="none",y=!0):u&&y?(o.style.display="none",a.style.display="flex",y=!1,E(p)):(o.style.display="flex",a.style.display="none",y=!1),S()})),s.forEach((e=>e.addEventListener("click",(function(){o.style.display="none",a.style.display="none",y=!0})))),n.forEach((e=>e.addEventListener("click",(function(){o.style.display="flex",a.style.display="none",y=!1})))),i.forEach((e=>e.addEventListener("click",q))),r.addEventListener("click",(function(){u=!0,v()})),c.addEventListener("click",x),l.addEventListener("keypress",(function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),x())})),o.style.display="none",a.style.display="none",async function(){const e=`${w()}-${p}`;try{const t=await fetch(`${d}/lrange/${e}/0/-1`,{method:"GET",headers:{Authorization:`Bearer ${m}`}}),s=await t.json();s.result&&Array.isArray(s.result)?s.result.map((e=>JSON.parse(e))).reverse().forEach((e=>{z(e.text,e.type,p,e.timestamp,!1)})):console.error("Invalid format of messages received:",s)}catch(e){console.error("Error loading chat history from Upstash:",e)}}()}));